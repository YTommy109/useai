# 4. Atlas の廃止と Alembic の採用

日付: 2025-11-28

## ステータス

承認

## コンテキスト

当初、SQLite のマイグレーション管理として [Atlas](https://atlasgo.io/) を採用していました（ADR-0002）。Atlas は宣言的なスキーマ管理が可能で強力なツールですが、以下の課題が判明しました。

1.  **環境制約**: 開発・運用環境の一部（職場の Windows 環境）において、外部バイナリツールのインストールに申請や承認プロセスが必要であり、導入のハードルが高い。
2.  **Python 完結の要望**: 環境構築の手間を最小限にするため、Python (3.12) と標準的なパッケージマネージャ (`uv`) だけで完結する構成が望ましい。

## 決定

*   **Atlas の利用を廃止します**。
*   **Alembic をマイグレーションツールとして採用します**。

[Alembic](https://alembic.sqlalchemy.org/) は SQLAlchemy の作者によって開発されているマイグレーションツールであり、以下の理由から今回の要件に適しています。

*   **Python 製**: `pip` (または `uv`) でインストール可能であり、追加のバイナリインストールが不要。
*   **SQLModel / SQLAlchemy との親和性**: SQLModel は SQLAlchemy をベースにしており、Alembic との統合がスムーズである。
*   **標準的**: Python エコシステムにおいて最も標準的なマイグレーションツールであり、知見が豊富。

## 結果

### メリット

*   **セットアップの簡素化**: `uv sync` だけでマイグレーションツールの準備が完了するため、Windows 環境や制限された環境での開発開始が容易になる。
*   **依存関係の集約**: プロジェクトの依存関係が `pyproject.toml` に集約され、管理しやすくなる。

### デメリット

*   **宣言的スキーマ管理の喪失**: Atlas のような「あるべき状態」を定義する方式から、Alembic の「変更履歴（リビジョン）」を積み上げる方式に変わるため、マイグレーションファイルの管理が必要になる。
*   **移行コスト**: 既存の Atlas 設定を削除し、Alembic の初期設定（`alembic init`）と既存スキーマへの追随を行う必要がある。

## 関連

*   [ADR-0002: Adopt Atlas for SQLite Migration](0002-adopt-atlas-for-sqlite-migration.md) (廃止)
