# 0001 – Web Application Stack

- ステータス: 承認
- 日付: 2025-11-21

## 背景

ユーザが入力したプロンプトを LLM に渡し、応答を表示する軽量な Python Web アプリを構築する。サーバーサイドレンダリングを維持しつつ、現代的な操作感とメンテナンス性を両立させたい。単一リポジトリでの簡素なデプロイ（SQLite、最小限のフロントエンドビルド）を保ちながら、フォーマッタ・型チェック・テストなどのツールで素早く安全に開発できることが要件である。

## 決定

以下のスタックを採用する:

- Python 3.12: 最新の標準ライブラリ改善と高速な非同期実行を享受する。
- FastAPI: 非同期対応の HTTP レイヤーとして採用し、OpenAPI ドキュメントと依存性注入を標準で提供する。
- Jinja2: フルページと HTMX の部分テンプレートをビルド不要で描画する。
- HTMX: プロンプト送信やストリーミング応答など段階的なインタラクションをサーバー主導で実現する。
- Pico CSS: ほぼカスタム CSS なしでモダンかつレスポンシブな UI を提供する軽量スタイルフレームワーク。
- SQLite: プロンプト/レスポンスを記録する組込 DB として採用し、追加インフラを不要にする。
- LangChain: プロンプトテンプレートと LLM 呼び出しを編成し、将来のモデル交換を容易にする。
- pytest: LLM スタブ用フィクスチャを備えたテストランナーとして採用する。
- taskipy: テスト・Lint・開発サーバーなどのローカルコマンドを再現性高く実行する。
- ruff / mypy: 小規模なコードベースでもコード品質を維持するため、Lint/フォーマットと型チェックを実施する。

## 影響

- 単一プロセスかつ Node ツール不要のため、DevOps の負担が小さくオンボーディングも容易。
- HTMX + Jinja2 によりフロントエンドコードを最小限に保てる一方、フォームやページ切替を超えるリッチなクライアント挙動には追加の JS が必要。
- SQLite はデプロイを簡素化するが水平スケールに制限があり、将来的なトラフィック増にはマイグレーションツールや外部 DB の検討が必要。
- LangChain はモデル交換を容易にする反面、依存関係の更新追従が発生する。
- ruff・mypy・pytest などの厳格なツールリングは初期設定コストこそあるが、機能追加時のリグレッションを抑制できる。
